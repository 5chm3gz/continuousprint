<div class="cp-header">
  <h3>Continuous Print Queue</h3>
  <div class="btn-group">
    <button class="btn" data-bind="click: function() {setActive(!active());}, css: {'btn-primary': !active(), 'btn-secondary': active()}">
      <i class="fa fa-play"></i>&nbsp;&nbsp;<span data-bind="text: active() ? 'Stop Managing' : 'Start Managing'"/>
    </button>
    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
      <i class="fas fa-ellipsis-v"></i>
    </a>
    <ul class="dropdown-menu">
      <li><a tabindex="-1" href="#" data-bind="click: clearSuccessful">Clear successful (green) items only</a></li>
      <li><a tabindex="-1" href="#" data-bind="click: clearCompleted">Clear all completed items</a></li>
      <li><a tabindex="-1" href="#" data-bind="click: clearAll">Clear everything</a></li>
      <li class="divider"></li>
      <li><a tabindex="-1" href="#" data-bind="click: refreshQueue">Refresh</a></li>
      <li><a href="https://github.com/Zinc-OS/continuousprint" target="_blank">Help</a></li>
    </ul>
  </div>
</div>

<span data-bind="visible:  active()"><i class="fa fa-spinner fa-spin" data-bind="visible: active()"></i></span>
<strong data-bind="text: status"></strong>
<hr/>

<div style='text-align: center' data-bind='visible: jobs().length === 0'>Queue is empty</div>

<div class="queue-header jobs-header">
  <div style="flex:1">Name</div>
  <div style="width: 150px">Progress</div>
  <div>Runs</div>
</div>
<div id="queue_list" class="accordion" data-bind="sortable: {foreach: jobs, options: {handle: '.fa-grip-lines-vertical', onStart: $root.sortStart, onEnd: $root.sortEnd, onMove: $root.sortMove}}, css: { 'loading': $root.loading()}" style="height:80vh; overflow-y: auto">
  <div class="accordion-group">
    <div class="accordion-heading queue-row-container">
      <i class="fas fa-grip-lines-vertical"></i>
      <input type="text" class="job-name" data-bind="textInput: name, event: { change: $root.setJobName }"></input>
      <div class="progress" data-bind="foreach: progress, css: { 'progress-striped active': $root.activeQueueSet() == idx }">
        <div data-bind="style: { flex: pct, order: order }, css: {'bar': result !== 'pending', 'bar-success': result == 'success', 'bar-danger': result.startsWith('failure')}"></div>
      </div>
      <div class="job-repeats">
        <span data-bind="value: num_completed()">/</span>
        <input class="fa fa-text count-box" type="number" data-bind="textInput: count, event: { change: set_count }"></input>
      </div>
      <div class="accordion-heading-button pull-right" data-bind="click: $root.remove"><i style="cursor: pointer" class="far fa-trash-alt"></i></div>
    </div>

    <div class="accordion-body collapse in">
      <div class="accordion-inner">
        <p>TODO some more stuff goes here</p>
        <div class="queue-header">
          <div style="flex:1">Name</div>
          <div style="width: 150px">Progress</div>
          <div>Count</div>
          <div>Total</div>
        </div>
        <div id="queue_sets" data-bind="sortable: {foreach: queuesets, options: {handle: '.fa-grip-lines-vertical', onStart: $root.sortStart, onEnd: $root.sortEnd, onMove: $root.sortMove, group: 'queuesets'}}, css: {'empty': queuesets().length < 1}" class="queuesets accordion">
          <div class="accordion-group">
            <div class="queue-row-container accordion-heading" data-bind="css: { 'updated-item': changed() && $root.selected() != idx }">
                <i class="fas fa-grip-lines-vertical"></i>
                <i style="cursor:pointer" class="fa" data-bind="click: $root.setSelected, css: {'fa-caret-down': $root.selected() == idx, 'fa-caret-right': $root.selected() != idx }"></i>
                <p class="file-name" data-bind="text: name, style: { 'font-weight': $root.activeQueueSet() == idx ? 'bold': null }"/>
                <div class="progress" data-bind="foreach: progress, css: { 'progress-striped active': $root.activeQueueSet() == idx }">
                  <div data-bind="style: { flex: pct, order: order }, css: {'bar': result !== 'pending', 'bar-success': result == 'success', 'bar-danger': result.startsWith('failure')}"></div>
                </div>
                <input class="fa fa-text count-box" type="number" data-bind="textInput: count, event: { change: set_count }"></input>
                <div data-bind="text: length"></div>
            
                <div class="accordion-heading-button" data-bind="click: $root.remove"><i style="cursor: pointer" class="far fa-trash-alt"></i></div>
            </div>

            <div class="accordion-body collapse" data-bind="css: {'in': $root.selected() === idx}">
              <div class="accordion-inner">
                <h5 data-bind="text: description"></h5>
                <table class="queue-set-list">
                  <thead><th>Name</th><th>SD</th><th>Status</th><th>Duration</th><th>Retries</th></thead>
                  <tbody data-bind="foreach: items">
                    <tr data-bind="style: { 'font-weight': $root.activeIdx() == idx ? 'bold' : null }, css: { 'updated-item': changed() , 'run-alt': (run % 2) === 0}">
                      <td data-bind="text:name"/>
                      <td data-bind="text: (sd) ? 'Y' : 'N'"/>
                      <td data-bind="text:result, style: { color: result().startsWith('failure') ? 'red' : null }"/>
                      <td data-bind="text:duration"/>
                      <td data-bind="text:retries"/>
                    </tr>
                  </tbody>
                </table>
              </div> 
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
